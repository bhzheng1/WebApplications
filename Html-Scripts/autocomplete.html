<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>jQuery UI Autocomplete - Custom data and display</title>

    <style>
        #project-label {
            display: block;
            font-weight: bold;
            margin-bottom: 1em;
        }

        #project-icon {
            float: left;
            height: 32px;
            width: 32px;
        }

        #project-description {
            margin: 0;
            padding: 0;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
        (function ($) {
            var currencyFormatter = new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0,
            });
            $.widget("custom.tablecomplete", $.ui.autocomplete, {
                _create: function () {
                    this._super();
                    this.widget().menu("option", "items", "> li:not(.ui-autocomplete-header)");
                },
                _renderMenu(ul, items) {
                    var self = this;
                    ul.addClass("container");
                    let header = {
                        label: "Label",
                        value: "Value",
                        isheader: true,
                        amount: "amount"
                    }
                    var $div = $("<div class='autocomplete-row-container'></div>");
                    self._renderItemData($div, header);
                    $.each(items, function (index, item) {
                        self._renderItemData($div, item);
                    });
                    $div.appendTo(ul);
                },
                _renderItemData(ul, item) {
                    return this._renderItem(ul, item).data("ui-autocomplete-item", item);
                },
                _renderItem(ul, item) {
                    var $li = $("<li class='ui-menu-item-wrapper ui-menu-item' role='presentation' style='display: flex; flex-direction: row;'></li>");
                    var $content = "<div class='ui-row-cell'>" + item.label + "</div>" + "<div class='ui-row-cell'>" + item.value + "</div>" + "<div class='ui-row-cell'>" + currencyFormatter.format(item.amount) + "</div>";
                    if (item.isheader) {
                        $li = $("<div class='ui-autocomplete-header' role='presentation' style='font-weight:bold !important; display: flex; flex-direction: row;'></div>");
                        $content = "<div class='ui-row-cell'>" + item.label + "</div>" + "<div class='ui-row-cell'>" + item.value + "</div>" + "<div class='ui-row-cell'>" + item.amount + "</div>";
                    }

                    $li.html($content);

                    return $li.appendTo(ul);
                }
            });

        })(jQuery);
    </script>
</head>

<body>
    <div>
        <div id="project-label">Select a project (type &quot;j&quot; for a start):</div>

        <input id="project">
        <input type="hidden" id="project-id">
        <p id="project-description"></p>
    </div>
    <div>
        <a
            href="https://stackoverflow.com/questions/48348490/jquery-autocomplete-with-custom-renderer-throwing-cannot-read-property-value">https://stackoverflow.com/questions/48348490/jquery-autocomplete-with-custom-renderer-throwing-cannot-read-property-value</a>
        <br />
        <a href="https://jsfiddle.net/sajjansarkar/j7fu060j/">https://jsfiddle.net/sajjansarkar/j7fu060j/</a>
        <br />
        <a href="https://jsfiddle.net/Twisty/192m0uyc/2/">https://jsfiddle.net/Twisty/192m0uyc/2/</a>
    </div>
    <input type="button" id="btntoggle" class="btn btn-primary" data-toggle="button" aria-pressed="false"
        autocomplete="off" class="btn">

    <div>
        <div id="project1-label">Select a project (type &quot;j&quot; for a start):</div>
        <div style="display: flex;">
            <input type="hidden" id="project1-value">
            <input id="project1">
            <input type="button" id="project1-btn" data-isVisible="false" onclick="project1buttonclick(this)" onmousedown="project1buttononmousedown(this)"
                value="show">
        </div>
        <p id="project-description1"></p>
    </div>
    <script type="text/javascript">
        $(document).ready(function () {
            var projects = [
                {
                    value: "jquery",
                    label: "jQuery",
                    desc: "the write less, do more, JavaScript library",
                    icon: "jquery_32x32.png",
                    amount: 1000
                },
                {
                    value: "jquery-ui",
                    label: "jQuery UI",
                    desc: "the official user interface library for jQuery",
                    icon: "jqueryui_32x32.png",
                    amount: 2000
                },
                {
                    value: "sizzlejs",
                    label: "Sizzle JS",
                    desc: "a pure-JavaScript CSS selector engine",
                    icon: "sizzlejs_32x32.png",
                    amount: 2322
                }
            ];

            $("#project").autocomplete({
                minLength: 0,
                source: projects,
                focus: function (event, ui) {
                    $("#project").val(ui.item.label);
                    return false;
                },
                select: function (event, ui) {
                    $("#project").val(ui.item.label);
                    $("#project-id").val(ui.item.value);
                    $("#project-description").html(ui.item.desc);
                    return false;
                }
            }).autocomplete("instance")._renderItem = function (ul, item) {
                return $("<li>")
                    .append("<div>" + item.label + "<br>" + item.desc + "</div>")
                    .appendTo(ul);
            };

            $("#project1").tablecomplete({
                minLength: 0,
                source: projects,
                focus: function (event, ui) {
                    $("#project").val(ui.item.label);
                    return false;
                },
                select: function (event, ui) {
                    $("#project1").val(ui.item.label);
                    $("#project1-value").val(ui.item.value);
                    $("#project1-description").html(ui.item.desc);

                    return false;
                },
                search:function(event,ui){
                },
                open: function (event, ui) { 
                    $('#project1-btn').val("close");
                },
                close: function (event, ui) {
                    $('#project1-btn').val("show");
                }
            });


        });

        function project1buttonclick(obj) {
            if ($(obj).data("isVisible") == "false") {
                $('#project1').tablecomplete("search", "");
            }
        };

        function project1buttononmousedown(obj) {
            if ($('#project1').tablecomplete("instance") && $('#project1').tablecomplete("widget").is(":visible")) {
                $(obj).data("isVisible", "true");
            } else {
                $(obj).data("isVisible", "false");
            }
        };
    </script>
</body>

</html>